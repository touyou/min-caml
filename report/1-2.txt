171023 藤井陽介

以下のプログラムをコンパイルすると

□fib_with_error.ml
let rec fib n =
  if th = n else
  fib (n - 1) + fib (n - 2) in
print (fib 30)

☆出力
Fatal error: exception Failure("parse error line 2, characters 28-32")

となります。
また

□fib_with_error2.ml
let rec fib n =
  if %% then 20 else
  fib (n - 1) + fib (n - 2) fib

これは

Fatal error: exception Failure("unknown token: % line 2, characters 21-22")

このように出るようになりました。

【コード】
□lexer.mll
let newline = '\r' | '\n' | "\r\n"

| newline
    { Lexing.new_line lexbuf;
      token lexbuf }

| _
    { failwith
        (Printf.sprintf "unknown token: %s line %d, characters %d-%d"
            (Lexing.lexeme lexbuf)
            (lexbuf.lex_curr_p.pos_lnum)
            (Lexing.lexeme_start lexbuf)
            (Lexing.lexeme_end lexbuf)
        ) }

□parser.mly
| error
    { failwith
        (Printf.sprintf "parse error line %d, characters %d-%d"
            (let pos = Parsing.symbol_start_pos () in pos.pos_lnum)
            (Parsing.symbol_start ())
            (Parsing.symbol_end ()))
    }